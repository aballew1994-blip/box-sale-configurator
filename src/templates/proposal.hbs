<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      font-size: 11px;
      color: #333;
      line-height: 1.5;
    }

    .header {
      background: #1a365d;
      color: white;
      padding: 24px 32px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .header h1 {
      font-size: 22px;
      font-weight: 700;
    }

    .header .estimate-info {
      text-align: right;
      font-size: 12px;
    }

    .header .estimate-info .number {
      font-size: 16px;
      font-weight: 600;
    }

    .section {
      padding: 20px 32px;
    }

    .section-title {
      font-size: 14px;
      font-weight: 700;
      color: #1a365d;
      border-bottom: 2px solid #1a365d;
      padding-bottom: 4px;
      margin-bottom: 12px;
    }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .info-block {
      font-size: 11px;
    }

    .info-block .label {
      font-weight: 600;
      color: #666;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .info-block .value {
      font-size: 12px;
      margin-top: 2px;
    }

    .flags-row {
      display: flex;
      gap: 24px;
      background: #f8fafc;
      padding: 8px 16px;
      border-radius: 4px;
      margin-bottom: 16px;
      font-size: 11px;
    }

    .flags-row .flag {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .flag .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
    }

    .dot.yes { background: #16a34a; }
    .dot.no { background: #dc2626; }

    /* Line item table */
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10px;
    }

    thead {
      background: #1a365d;
      color: white;
    }

    thead th {
      padding: 6px 8px;
      text-align: left;
      font-weight: 600;
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    thead th.right { text-align: right; }

    tbody tr {
      border-bottom: 1px solid #e2e8f0;
    }

    tbody tr:nth-child(even) {
      background: #f8fafc;
    }

    tbody td {
      padding: 6px 8px;
      vertical-align: top;
    }

    tbody td.right { text-align: right; }
    tbody td.desc { max-width: 200px; }

    /* Summary */
    .summary-table {
      width: 300px;
      margin-left: auto;
      margin-top: 16px;
      font-size: 12px;
    }

    .summary-table td {
      padding: 4px 8px;
    }

    .summary-table .label { font-weight: 400; }
    .summary-table .value { text-align: right; font-weight: 500; }

    .summary-table tr.total {
      border-top: 2px solid #1a365d;
    }

    .summary-table tr.total td {
      font-weight: 700;
      font-size: 14px;
      padding-top: 8px;
    }

    /* Scope / Notes */
    .text-block {
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      border-radius: 4px;
      padding: 12px 16px;
      font-size: 11px;
      white-space: pre-wrap;
      line-height: 1.6;
    }

    /* Contact */
    .contact-row {
      display: flex;
      gap: 32px;
      font-size: 11px;
    }

    .contact-row .field {
      display: flex;
      gap: 8px;
    }

    .contact-row .field .label { font-weight: 600; color: #666; }

    /* Footer */
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 8px 32px;
      font-size: 9px;
      color: #999;
      text-align: center;
      border-top: 1px solid #e2e8f0;
    }

    .page-break { page-break-before: always; }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div>
      <h1>Box Sale Proposal</h1>
      {{#if customer}}
      <div style="margin-top: 4px; font-size: 13px; opacity: 0.9;">
        {{customer.name}}
      </div>
      {{/if}}
    </div>
    <div class="estimate-info">
      {{#if estimate}}
      <div class="number">{{estimate.tranId}}</div>
      <div>Date: {{formatDate generatedDate}}</div>
      <div>Sales Rep: {{estimate.salesRep}}</div>
      {{/if}}
    </div>
  </div>

  <!-- Customer & Proposal Info -->
  <div class="section">
    <div class="section-title">Proposal Details</div>
    <div class="info-grid">
      <div>
        {{#if customer}}
        <div class="info-block">
          <div class="label">Bill To</div>
          <div class="value">
            {{customer.name}}<br>
            {{#if customer.billingAddress}}
            {{customer.billingAddress.addr1}}<br>
            {{#if customer.billingAddress.addr2}}{{customer.billingAddress.addr2}}<br>{{/if}}
            {{customer.billingAddress.city}}, {{customer.billingAddress.state}} {{customer.billingAddress.zip}}
            {{/if}}
          </div>
        </div>
        {{/if}}
      </div>
      <div>
        {{#if customer}}
        <div class="info-block">
          <div class="label">Ship To</div>
          <div class="value">
            {{#if customer.shippingAddress}}
            {{customer.shippingAddress.addr1}}<br>
            {{#if customer.shippingAddress.addr2}}{{customer.shippingAddress.addr2}}<br>{{/if}}
            {{customer.shippingAddress.city}}, {{customer.shippingAddress.state}} {{customer.shippingAddress.zip}}
            {{else}}
            Same as billing
            {{/if}}
          </div>
        </div>
        {{/if}}
      </div>
    </div>

    {{#if config.contactFirstName}}
    <div class="contact-row" style="margin-top: 12px;">
      <div class="field">
        <span class="label">Contact:</span>
        <span>{{config.contactFirstName}} {{config.contactLastName}}</span>
      </div>
      {{#if config.contactEmail}}
      <div class="field">
        <span class="label">Email:</span>
        <span>{{config.contactEmail}}</span>
      </div>
      {{/if}}
    </div>
    {{/if}}
  </div>

  <!-- Configuration Flags -->
  <div class="section" style="padding-top: 0;">
    <div class="flags-row">
      <div class="flag">
        <span class="dot {{#if config.accessControlCards}}yes{{else}}no{{/if}}"></span>
        Access Control Cards: {{#if config.accessControlCards}}Yes{{else}}No{{/if}}
      </div>
      <div class="flag">
        <span class="dot {{#if config.licensingSSA}}yes{{else}}no{{/if}}"></span>
        Licensing & SSA: {{#if config.licensingSSA}}Yes{{else}}No{{/if}}
      </div>
      <div class="flag">
        <span class="dot {{#if config.saas}}yes{{else}}no{{/if}}"></span>
        SaaS: {{#if config.saas}}Yes{{else}}No{{/if}}
      </div>
    </div>
  </div>

  <!-- Line Items -->
  <div class="section" style="padding-top: 0;">
    <div class="section-title">Equipment List</div>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Part #</th>
          <th>Manufacturer</th>
          <th>Description</th>
          <th class="right">Qty</th>
          <th class="right">Unit Price</th>
          <th class="right">Ext. Price</th>
        </tr>
      </thead>
      <tbody>
        {{#each lineItems}}
        <tr>
          <td>{{inc @index}}</td>
          <td>{{partNumber}}</td>
          <td>{{manufacturer}}</td>
          <td class="desc">{{description}}</td>
          <td class="right">{{quantity}}</td>
          <td class="right">{{formatCurrency productPrice}}</td>
          <td class="right">{{formatCurrency totalPrice}}</td>
        </tr>
        {{/each}}
      </tbody>
    </table>

    <!-- Summary totals -->
    <table class="summary-table">
      <tr>
        <td class="label">Equipment Total</td>
        <td class="value">{{formatCurrency summary.totalPrice}}</td>
      </tr>
      <tr>
        <td class="label">Shipping</td>
        <td class="value">{{formatCurrency summary.shippingFee}}</td>
      </tr>
      <tr class="total">
        <td class="label">Subtotal</td>
        <td class="value">{{formatCurrency summary.subtotal}}</td>
      </tr>
    </table>
  </div>

  <!-- Scope of Work / Proposal Summary -->
  {{#if config.proposalSummary}}
  <div class="section">
    <div class="section-title">Scope of Work</div>
    <div class="text-block">{{config.proposalSummary}}</div>
  </div>
  {{/if}}

  <!-- Footer -->
  <div class="footer">
    Generated {{formatDate generatedDate}} | Configuration v{{config.version}} | Box Sale Configurator
  </div>
</body>
</html>
